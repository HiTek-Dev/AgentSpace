---
phase: 13-rebrand-tek
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - packages/cli/package.json
  - packages/cli/src/index.ts
  - packages/cli/src/commands/config.ts
  - packages/cli/src/commands/init.ts
  - packages/cli/src/commands/chat.ts
  - packages/cli/src/components/Onboarding.tsx
  - packages/cli/src/components/StatusBar.tsx
  - packages/cli/src/vault/keychain.ts
  - packages/cli/src/hooks/useSlashCommands.ts
  - packages/core/src/skills/loader.ts
  - packages/core/src/errors.ts
  - packages/core/src/index.ts
  - packages/gateway/src/mcp/client-manager.ts
  - packages/gateway/src/agent/tool-registry.ts
  - packages/gateway/src/llm/provider.ts
  - packages/db/drizzle.config.ts
  - packages/db/src/memory/ensure-memory.ts
  - packages/telegram/src/handlers/commands.ts
  - scripts/install.sh
  - scripts/update.sh
  - scripts/reset.sh
  - INSTALL.md
  - ONESHEET.md
autonomous: true
requirements:
  - CLI command rename to tek
  - config path migration
  - install/update script updates
  - documentation updates
  - verify clean uninstall

must_haves:
  truths:
    - "User types 'tek' to launch the CLI"
    - "Config/data paths use ~/.config/tek instead of ~/.config/agentspace"
    - "Existing users' config is migrated automatically on first run"
    - "install.sh creates bin/tek symlink and uses tek paths"
    - "All user-facing display strings say Tek instead of AgentSpace"
    - "Keychain service is tek; old agentspace keys are migrated silently"
    - "Deleting the install directory leaves no orphan processes"
  artifacts:
    - path: "packages/cli/package.json"
      provides: "bin entry for tek command"
      contains: "\"tek\": \"./dist/index.js\""
    - path: "packages/cli/src/index.ts"
      provides: "CLI entrypoint with tek command name"
      contains: ".name(CLI_COMMAND)"
    - path: "scripts/install.sh"
      provides: "Install script using tek paths"
      contains: "tek"
    - path: "scripts/update.sh"
      provides: "Update script using tek paths"
      contains: "tek"
    - path: "scripts/reset.sh"
      provides: "Reset script using tek paths"
      contains: "tek"
  key_links:
    - from: "packages/cli/src/vault/keychain.ts"
      to: "packages/core/src/config/constants.ts"
      via: "import KEYCHAIN_SERVICE"
      pattern: "KEYCHAIN_SERVICE"
    - from: "packages/cli/src/index.ts"
      to: "packages/core/src/config/constants.ts"
      via: "import CLI_COMMAND, DISPLAY_NAME"
      pattern: "CLI_COMMAND|DISPLAY_NAME"
    - from: "packages/core/src/skills/loader.ts"
      to: "packages/core/src/config/constants.ts"
      via: "import CONFIG_DIR_NAME"
      pattern: "CONFIG_DIR_NAME"
---

<objective>
Rename all runtime references: CLI command becomes `tek`, config paths become `~/.config/tek`, scripts use new names, display strings updated, keychain service migrated, and documentation reflects the new brand.

Purpose: This completes the user-facing rename. After this plan, users interact with "tek" everywhere. Existing installations get automatic migration of config and keychain on first run.
Output: Fully rebranded runtime experience with backward-compatible migration.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-rebrand-tek/13-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename CLI command, display strings, keychain, and hardcoded paths</name>
  <files>
    packages/cli/package.json
    packages/cli/src/index.ts
    packages/cli/src/commands/config.ts
    packages/cli/src/commands/init.ts
    packages/cli/src/commands/chat.ts
    packages/cli/src/components/Onboarding.tsx
    packages/cli/src/components/StatusBar.tsx
    packages/cli/src/vault/keychain.ts
    packages/cli/src/hooks/useSlashCommands.ts
    packages/core/src/skills/loader.ts
    packages/core/src/errors.ts
    packages/core/src/index.ts
    packages/gateway/src/mcp/client-manager.ts
    packages/gateway/src/agent/tool-registry.ts
    packages/gateway/src/llm/provider.ts
    packages/db/drizzle.config.ts
    packages/db/src/memory/ensure-memory.ts
    packages/telegram/src/handlers/commands.ts
  </files>
  <action>
    **Config path migration at startup (packages/cli/src/index.ts):**
    - Before the existing configExists() check, add a migration check:
      1. Import `CONFIG_DIR, CONFIG_DIR_NAME` from `@tek/core` and `join, homedir, renameSync, existsSync` from node
      2. Check if `~/.config/agentspace` exists AND `~/.config/tek` does NOT exist
      3. If so, rename `~/.config/agentspace` to `~/.config/tek` via `renameSync`
      4. If `~/.config/tek/agentspace.db` exists, rename to `~/.config/tek/tek.db`
      5. Log a one-liner: `console.log("Migrated config from ~/.config/agentspace to ~/.config/tek")`
    - This ensures users who do git pull + rebuild (without re-running install.sh) get their config migrated on first `tek` invocation.

    **CLI binary rename:**
    - `packages/cli/package.json`: Change bin entry from `"agentspace": "./dist/index.js"` to `"tek": "./dist/index.js"`

    **CLI entrypoint (packages/cli/src/index.ts):**
    - Import `CLI_COMMAND, DISPLAY_NAME` from `@tek/core`
    - `.name("agentspace")` -> `.name(CLI_COMMAND)`
    - `.description("AgentSpace - ...")` -> `.description(\`${DISPLAY_NAME} - A self-hosted AI agent platform...\`)`
    - All `'agentspace init'`, `'agentspace chat'` strings -> use template literals with CLI_COMMAND
    - `'AgentSpace is not configured...'` -> use DISPLAY_NAME

    **Display strings in commands:**
    - `packages/cli/src/commands/config.ts`: Replace "AgentSpace configuration", "AgentSpace is not configured", "agentspace init" with constants-derived equivalents. Import CLI_COMMAND and DISPLAY_NAME from @tek/core.
    - `packages/cli/src/commands/init.ts`: Replace "Set up AgentSpace", "AgentSpace is already configured" with DISPLAY_NAME.
    - `packages/cli/src/commands/chat.ts`: Replace "agentspace chat" with CLI_COMMAND template.
    - `packages/cli/src/components/Onboarding.tsx`: Replace "Welcome to AgentSpace", "AgentSpace is a self-hosted", "agentspace keys add", "agentspace keys list", "agentspace config show" with constants-derived strings.
    - `packages/cli/src/components/StatusBar.tsx`: Replace "AgentSpace" with DISPLAY_NAME.

    **Keychain service (packages/cli/src/vault/keychain.ts):**
    - Import `KEYCHAIN_SERVICE` from `@tek/core`
    - Replace `const SERVICE_NAME = "agentspace"` with `const SERVICE_NAME = KEYCHAIN_SERVICE`
    - Add a migration function `migrateKeychainEntries()` that:
      1. Tries to read known accounts from old service "agentspace" (accounts: "api-key:anthropic", "api-key:openai", "api-key:venice", "api-key:google", "api-endpoint-token")
      2. For each found: copy to new service name, delete from old
      3. Runs once on first call, uses a module-level `migrated = false` flag
    - Call `migrateKeychainEntries()` at the start of `keychainGet()` so migration happens transparently on first key access

    **Hardcoded "agentspace" in paths/names:**
    - `packages/core/src/skills/loader.ts:50,53`: Replace hardcoded `"agentspace"` with `CONFIG_DIR_NAME` from constants. Import it.
      - Line 50: `join(homedir(), ".config", "agentspace", "skills")` -> `join(homedir(), ".config", CONFIG_DIR_NAME, "skills")`
      - Line 53: `join(config.workspaceDir, ".agentspace", "skills")` -> `join(config.workspaceDir, \`.${CONFIG_DIR_NAME}\`, "skills")`
    - `packages/gateway/src/mcp/client-manager.ts:74,85`: Replace `agentspace-${serverName}` with import of PROJECT_NAME from @tek/core and use `${PROJECT_NAME}-${serverName}`.
    - `packages/gateway/src/agent/tool-registry.ts:107,114`: Replace `agentspace-skill-sandbox-` with `${PROJECT_NAME}-skill-sandbox-`. Replace hardcoded `.config/agentspace/skills` with import of CONFIG_DIR_NAME.
    - `packages/gateway/src/llm/provider.ts:18`: Replace `"agentspace keys add anthropic"` with `"${CLI_COMMAND} keys add anthropic"`. Import CLI_COMMAND from @tek/core.

    **Additional files with hardcoded "agentspace" references:**
    - `packages/core/src/errors.ts`: Rename `AgentSpaceError` class to `TekError`. Update `this.name = "TekError"`. Update the export in `packages/core/src/index.ts` to export `TekError` (and add `export { TekError as AgentSpaceError }` as a backward-compat alias). Update any imports of `AgentSpaceError` across all packages to use `TekError`.
    - `packages/db/drizzle.config.ts`: Replace hardcoded `join(homedir(), ".config", "agentspace", "agentspace.db")` with import of `DB_PATH` from `@tek/core`.
    - `packages/db/src/memory/ensure-memory.ts`: Replace log string `[agentspace]` with `[tek]` and path reference `~/.config/agentspace/memory/` with template using CONFIG_DIR_NAME from `@tek/core`.
    - `packages/telegram/src/handlers/commands.ts`: Replace all display strings â€” "AgentSpace" -> DISPLAY_NAME, "agentspace pair telegram" -> `${CLI_COMMAND} pair telegram`. Import DISPLAY_NAME and CLI_COMMAND from `@tek/core`.
    - `packages/cli/src/hooks/useSlashCommands.ts`: Replace `"agentspace.json"` with `"tek.json"` (workspace config filename). Update any display strings referencing "agentspace".
  </action>
  <verify>
    Run full two-pass build:
    ```
    cd /Users/hitekmedia/Documents/GitHub/AgentSpace
    (cd packages/core && npx tsc -p tsconfig.json)
    (cd packages/db && npx tsc -p tsconfig.json)
    (cd packages/gateway && npx tsc -p tsconfig.json 2>/dev/null) || true
    (cd packages/cli && npx tsc -p tsconfig.json)
    (cd packages/gateway && npx tsc -p tsconfig.json)
    (cd packages/telegram && npx tsc -p tsconfig.json)
    ```
    Zero errors.
    Verify no remaining hardcoded "agentspace" in source: `grep -rn "agentspace" packages/ --include="*.ts" --include="*.tsx" | grep -v node_modules | grep -v dist | grep -v .tsbuildinfo | grep -v "// migrat"` should return empty (migration comments excluded).
  </verify>
  <done>
    CLI bin is "tek". All display strings use DISPLAY_NAME/CLI_COMMAND from constants. Keychain uses KEYCHAIN_SERVICE with silent migration from old "agentspace" service. All hardcoded "agentspace" paths use constants. Full build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update install/update/reset scripts and documentation</name>
  <files>
    scripts/install.sh
    scripts/update.sh
    scripts/reset.sh
    INSTALL.md
    ONESHEET.md
  </files>
  <action>
    **scripts/install.sh:**
    - Line 1 comment: "AgentSpace Install Script" -> "Tek Install Script"
    - `INSTALL_DIR="${1:-$HOME/agentspace}"` -> `INSTALL_DIR="${1:-$HOME/tek}"`
    - `CONFIG_DIR="$HOME/.config/agentspace"` -> `CONFIG_DIR="$HOME/.config/tek"`
    - All echo strings: "AgentSpace" -> "Tek"
    - Add config migration block BEFORE memory seeding (after creating CONFIG_DIR):
      ```bash
      # Migrate from old config location if present
      OLD_CONFIG="$HOME/.config/agentspace"
      if [ -d "$OLD_CONFIG" ] && [ ! -d "$CONFIG_DIR" ]; then
        echo "Migrating config from $OLD_CONFIG to $CONFIG_DIR..."
        mv "$OLD_CONFIG" "$CONFIG_DIR"
        # Rename database file if it exists
        if [ -f "$CONFIG_DIR/agentspace.db" ]; then
          mv "$CONFIG_DIR/agentspace.db" "$CONFIG_DIR/tek.db"
        fi
        echo "Migration complete."
      fi
      ```
    - Bin symlink: `ln -sf "../packages/cli/dist/index.js" "$INSTALL_DIR/bin/agentspace"` -> `ln -sf "../packages/cli/dist/index.js" "$INSTALL_DIR/bin/tek"`
    - PATH instructions: `agentspace` -> `tek`

    **scripts/update.sh:**
    - Comment: "AgentSpace Update Script" -> "Tek Update Script"
    - `INSTALL_DIR="${1:-$HOME/agentspace}"` -> `INSTALL_DIR="${1:-$HOME/tek}"`
    - `CONFIG_DIR="$HOME/.config/agentspace"` -> `CONFIG_DIR="$HOME/.config/tek"`
    - All echo strings: "AgentSpace" -> "Tek"

    **scripts/reset.sh:**
    - `CONFIG_DIR="$HOME/.config/agentspace"` -> `CONFIG_DIR="$HOME/.config/tek"`
    - All echo strings and warning text: replace "AgentSpace" with "Tek", "agentspace" with "tek"
    - Database path in warning: `agentspace.db` -> `tek.db`
    - Keychain instructions at end: `agentspace keys remove` -> `tek keys remove`
    - Re-init instruction: `agentspace init` -> `tek init`

    **INSTALL.md:**
    - Title: "AgentSpace" -> "Tek"
    - All `scripts/install.sh ~/agentspace` -> `scripts/install.sh ~/tek`
    - All `scripts/update.sh ~/agentspace` -> `scripts/update.sh ~/tek`
    - All `~/.config/agentspace` -> `~/.config/tek`
    - All `~/agentspace` -> `~/tek`
    - All `agentspace.db` -> `tek.db`
    - All `agentspace init`, `agentspace chat`, etc. -> `tek init`, `tek chat`
    - Bin symlink: `bin/agentspace` -> `bin/tek`
    - Keychain service: `agentspace` -> `tek`
    - PATH instructions update

    **ONESHEET.md:**
    - Title and all "AgentSpace" -> "Tek"
    - Package table: `@agentspace/*` -> `@tek/*`
    - Entry point: `agentspace` -> `tek`
    - All paths: `~/.config/agentspace` -> `~/.config/tek`
    - All commands: `agentspace init`, `agentspace chat`, etc. -> `tek init`, `tek chat`
    - Keychain service references
    - Install commands: `~/agentspace` -> `~/tek`
    - Database: `agentspace.db` -> `tek.db`

    **Add uninstall documentation to INSTALL.md:**
    Add a section "## 4. Uninstalling" after the Fresh Start section:
    ```markdown
    ## 4. Uninstalling

    Tek runs as a foreground process only -- no LaunchAgents, system services, or cron jobs are installed.

    To fully uninstall:

    1. Delete the install directory: `rm -rf ~/tek` (or wherever you installed)
    2. Delete config/data: `rm -rf ~/.config/tek`
    3. Remove from PATH (edit `~/.zshrc` or `~/.bashrc`)
    4. (Optional) Remove API keys from Keychain: `tek keys remove <provider>` before deleting, or use Keychain Access.app to find entries with service "tek"

    Deleting the install directory immediately stops all functionality. There are no background processes to clean up.
    ```
  </action>
  <verify>
    1. `grep -n "agentspace" scripts/install.sh scripts/update.sh scripts/reset.sh` returns only the migration block references to the OLD path (those are intentional).
    2. `grep -in "agentspace" INSTALL.md ONESHEET.md` returns empty (all references updated).
    3. Verify install.sh has migration block: `grep "Migrating config" scripts/install.sh` returns a match.
    4. Verify INSTALL.md has uninstall section: `grep "Uninstalling" INSTALL.md` returns a match.
  </verify>
  <done>
    All 3 scripts use tek paths with agentspace->tek migration in install.sh. Both documentation files fully updated. Uninstall process documented. No orphan process risk documented and confirmed.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "agentspace" packages/ --include="*.ts" --include="*.tsx" --include="*.json" | grep -v node_modules | grep -v dist | grep -v .tsbuildinfo` returns empty
2. `grep -n "agentspace" scripts/*.sh | grep -v "OLD_CONFIG\|old config\|agentspace.db.*tek.db\|Migrating"` returns empty (only migration references remain)
3. `grep -in "agentspace" INSTALL.md ONESHEET.md` returns empty
4. Full two-pass build succeeds
5. `node packages/cli/dist/index.js --help` shows "tek" as the command name
6. Keychain migration function exists in keychain.ts
</verification>

<success_criteria>
- CLI binary name is "tek" (package.json bin entry)
- All user-facing strings use Tek/tek (not AgentSpace/agentspace)
- Keychain service migrates silently from "agentspace" to "tek"
- Config path migration from ~/.config/agentspace to ~/.config/tek in install.sh
- Scripts default to ~/tek install directory
- INSTALL.md documents clean uninstall (no orphan processes)
- Zero hardcoded "agentspace" remaining in source (excluding migration code)
</success_criteria>

<output>
After completion, create `.planning/phases/13-rebrand-tek/13-02-SUMMARY.md`
</output>
