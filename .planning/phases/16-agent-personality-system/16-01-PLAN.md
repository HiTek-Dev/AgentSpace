---
phase: 16-agent-personality-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/db/memory-files/SOUL.md
  - packages/db/memory-files/IDENTITY.md
  - packages/db/memory-files/USER.md
  - packages/db/memory-files/STYLE.md
  - packages/db/memory-files/AGENTS.md
  - packages/db/src/memory/identity-manager.ts
  - packages/db/src/memory/ensure-memory.ts
  - packages/db/src/memory/index.ts
autonomous: true
requirements: []

must_haves:
  truths:
    - "Identity template files exist for SOUL, IDENTITY, USER, STYLE, AGENTS"
    - "Each identity file has a loader function that seeds from template on first run"
    - "Richer SOUL.md template is 50-100 lines with opinionated defaults"
    - "All new loaders follow exact pattern of existing loadSoul()"
  artifacts:
    - path: "packages/db/memory-files/SOUL.md"
      provides: "Expanded 50-100 line opinionated soul template"
      contains: "## Core Truths"
    - path: "packages/db/memory-files/IDENTITY.md"
      provides: "Agent presentation template (name, emoji, avatar)"
      contains: "## Name"
    - path: "packages/db/memory-files/USER.md"
      provides: "Static user context template"
      contains: "## About You"
    - path: "packages/db/memory-files/STYLE.md"
      provides: "Writing style guide template"
      contains: "## Tone"
    - path: "packages/db/memory-files/AGENTS.md"
      provides: "Multi-agent coordination template"
      contains: "## Agents"
    - path: "packages/db/src/memory/identity-manager.ts"
      provides: "Loader functions for IDENTITY, USER, STYLE, AGENTS files"
      exports: ["loadIdentity", "loadStyle", "loadUser", "loadAgentsConfig"]
    - path: "packages/db/src/memory/index.ts"
      provides: "Re-exports for new identity functions"
  key_links:
    - from: "packages/db/src/memory/identity-manager.ts"
      to: "packages/db/src/memory/ensure-memory.ts"
      via: "ensureMemoryFile() call"
      pattern: "ensureMemoryFile"
    - from: "packages/db/src/memory/index.ts"
      to: "packages/db/src/memory/identity-manager.ts"
      via: "re-export"
      pattern: "export.*from.*identity-manager"
---

<objective>
Create the multi-file identity architecture: expand SOUL.md to a richer 50-100 line template, create new template files (IDENTITY.md, USER.md, STYLE.md, AGENTS.md), and build loader functions following the established loadSoul() pattern.

Purpose: Provides the foundation for richer agent personality by splitting identity concerns into focused files, each with its own template and loader.
Output: 5 template files in memory-files/, identity-manager.ts with 4 new loader functions, expanded exports from @tek/db.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/db/src/memory/soul-manager.ts
@packages/db/src/memory/ensure-memory.ts
@packages/db/src/memory/index.ts
@packages/db/memory-files/SOUL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create identity template files and expand SOUL.md</name>
  <files>
    packages/db/memory-files/SOUL.md
    packages/db/memory-files/IDENTITY.md
    packages/db/memory-files/USER.md
    packages/db/memory-files/STYLE.md
    packages/db/memory-files/AGENTS.md
  </files>
  <action>
    Replace the existing 20-line SOUL.md with an expanded 50-100 line opinionated template. Structure:
    - `## Core Truths` (5-7 opinionated values: be helpful not performative, have opinions, earn trust through competence, be resourceful before asking, remember you are a guest in the user's world)
    - `## Communication Style` (concise/detailed switching, technical precision, lead with answer, code over theory)
    - `## Vibe` (balance directness with warmth, avoid corporate-speak and sycophancy, okay to say "I don't know")
    - `## Boundaries` (never fabricate, cite sources, respect privacy, ask before external actions)
    - `## Continuity` (these files ARE your memory, read and update them, SOUL.md = who you are, MEMORY.md = what you know)
    - `## Learned Preferences` (empty section with placeholder comment, same as current)

    Create IDENTITY.md template:
    - `## Name` (placeholder for agent display name)
    - `## Emoji` (placeholder, e.g., a default emoji)
    - `## Tagline` (one-line personality summary placeholder)

    Create USER.md template:
    - `## About You` (placeholder for user's name, role, preferences)
    - `## Working Style` (how user prefers to work with the agent)
    - `## Context` (user's current projects, tech stack, etc.)

    Create STYLE.md template:
    - `## Tone` (formal/casual/balanced spectrum)
    - `## Formatting` (markdown preferences, code style, list vs prose)
    - `## Language` (preferred language, technical level)
    - `## Examples` (placeholder for style samples)

    Create AGENTS.md template:
    - `## Agents` (placeholder explaining multi-agent coordination)
    - `## Routing Rules` (when to use which agent)
    - `## Shared Context` (what all agents should know)

    All templates should be markdown with helpful comments explaining each section. Keep each under 40 lines to stay within token budget.
  </action>
  <verify>All 5 template files exist in packages/db/memory-files/ and are valid markdown. Combined token count of SOUL + IDENTITY + STYLE stays under 3000 tokens (estimate: each file is 20-50 lines).</verify>
  <done>SOUL.md is 50-100 lines with opinionated defaults. IDENTITY.md, USER.md, STYLE.md, AGENTS.md all exist with structured section templates.</done>
</task>

<task type="auto">
  <name>Task 2: Create identity-manager.ts loaders and wire exports</name>
  <files>
    packages/db/src/memory/identity-manager.ts
    packages/db/src/memory/index.ts
  </files>
  <action>
    Create `packages/db/src/memory/identity-manager.ts` with 4 loader functions following the exact pattern of `loadSoul()` in soul-manager.ts:

    ```typescript
    import { existsSync, readFileSync } from "node:fs";
    import { join } from "node:path";
    import { CONFIG_DIR } from "@tek/core";
    import { ensureMemoryFile } from "./ensure-memory.js";

    const IDENTITY_PATH = join(CONFIG_DIR, "memory", "IDENTITY.md");
    const STYLE_PATH = join(CONFIG_DIR, "memory", "STYLE.md");
    const USER_PATH = join(CONFIG_DIR, "memory", "USER.md");
    const AGENTS_PATH = join(CONFIG_DIR, "memory", "AGENTS.md");

    export function loadIdentity(): string {
      ensureMemoryFile("IDENTITY.md", "IDENTITY.md");
      if (!existsSync(IDENTITY_PATH)) return "";
      return readFileSync(IDENTITY_PATH, "utf-8");
    }

    export function loadStyle(): string {
      ensureMemoryFile("STYLE.md", "STYLE.md");
      if (!existsSync(STYLE_PATH)) return "";
      return readFileSync(STYLE_PATH, "utf-8");
    }

    export function loadUser(): string {
      ensureMemoryFile("USER.md", "USER.md");
      if (!existsSync(USER_PATH)) return "";
      return readFileSync(USER_PATH, "utf-8");
    }

    export function loadAgentsConfig(): string {
      ensureMemoryFile("AGENTS.md", "AGENTS.md");
      if (!existsSync(AGENTS_PATH)) return "";
      return readFileSync(AGENTS_PATH, "utf-8");
    }
    ```

    Update `packages/db/src/memory/index.ts` to re-export all 4 functions:
    ```typescript
    export { loadIdentity, loadStyle, loadUser, loadAgentsConfig } from "./identity-manager.js";
    ```

    Do NOT modify soul-manager.ts or ensure-memory.ts in this task.
  </action>
  <verify>Run `npx tsc --noEmit` from packages/db/ to confirm no type errors. Verify index.ts exports all 4 new functions.</verify>
  <done>identity-manager.ts exports loadIdentity, loadStyle, loadUser, loadAgentsConfig. All follow the loadSoul() pattern (ensureMemoryFile + existsSync + readFileSync). index.ts re-exports them.</done>
</task>

</tasks>

<verification>
- `ls packages/db/memory-files/` shows SOUL.md, IDENTITY.md, USER.md, STYLE.md, AGENTS.md, MEMORY.md
- `wc -l packages/db/memory-files/SOUL.md` shows 50-100 lines
- `grep -c "export function" packages/db/src/memory/identity-manager.ts` returns 4
- `npx tsc --noEmit` passes from packages/db/
</verification>

<success_criteria>
- 5 identity template files exist with structured markdown sections
- SOUL.md is 50-100 lines with opinionated personality defaults
- 4 new loader functions in identity-manager.ts follow loadSoul() pattern exactly
- All new functions exported from @tek/db via index.ts
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-agent-personality-system/16-01-SUMMARY.md`
</output>
